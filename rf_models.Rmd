---
title: "Random Forest"
output: html_notebook
---

```{r}
source("2-model_tests.R")
```

## Random Forest

### Grouped Categorical Data
```{r}
rfGrid <- data.frame(mtry = c(5, 20, 50, 100, 250, 500, 1000)) # 10, 32
```

```{r}
rfGrid <- data.frame(mtry = c(5, 20, 50, 100))

if (!file.exists("models/rf_set.Rds")) {
    set.seed(1056)
    rf.set <- train(
        Party ~ .,
        data = train.set[, -1],
        method = "rf",
        trControl = ctrl,
        tuneGrid = rfGrid,
        metric = "ROC",
        ntree = 1500,
        importance = TRUE
    )
    
    saveRDS(rf.set, "models/rf_set.Rds")

} else {
    library(rf)
    rf.set <- readRDS("models/rf_set.Rds")
}
```

### Independent Categorical Data
```{r}
rfGrid <- data.frame(mtry = c(5, 50, 100, 200, 300))

if (!file.exists("models/rf_dv.Rds")) {
    set.seed(1056)
    rf.dv <- train(
        Party ~ .,
        data = train.dv[, -1],
        method = "rf",
        trControl = ctrl,
        tuneGrid = rfGrid,
        metric = "ROC",
        ntree = 1500,
        importance = TRUE
    )
    
    saveRDS(rf.dv, "models/rf_dv.Rds")

} else {
    library(rf)
    rf.dv <- readRDS("models/rf_dv.Rds")
}
```

```{r}
rf.set
```

```{r}
rf.dv
```

```{r}
pred1 <- predict(rf.set, valid.set[, -1])
pred2 <- predict(rf.dv, valid.dv[, -1])
```

```{r}
confusionMatrix(pred1, valid.party)
```

```{r}
confusionMatrix(pred2, valid.party)
```

```{r}
vi1 <- varImp(rf.set)
plot(vi1, top = 20)
```

```{r}
vi2 <-varImp(rf.dv)
plot(vi2, top = 20)
```


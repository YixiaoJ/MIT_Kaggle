---
title: "Linear Classification Models"
output: html_notebook
---

```{r}
source("2-model_tests.R")
```

## Partial Least Squares

```{r}
plsGrid <- expand.grid(.ncomp = 1:10)
```

### PCA

```{r}
if (!file.exists("models/pls_dv.Rds")) {
    set.seed(1056)
    pls.dv <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "pls",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = plsGrid,
        preProcess = c("nzv", "pca")
    )
    
    saveRDS(pls.dv, "models/pls_dv.Rds")

} else {
    library(pls)
    pls.dv <- readRDS("models/pls_dv.Rds")
}
```

```{r}
pls.dv
```

```{r}
pred.pls.dv <- predict(pls.dv, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.pls.dv, valid.party)
```

### MCA

```{r}
if (!file.exists("models/pls_mca.Rds")) {
    set.seed(1056)
    pls.mca <- train(
        Party ~ .,
        data = train.mca[, -1],
        method = "pls",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = plsGrid
        # preProcess = c("center", "scale")
    )
    
    saveRDS(pls.mca, "models/pls_mca.Rds")

} else {
    library(pls)
    pls.mca <- readRDS("models/pls_mca.Rds")
}
```

```{r}
pls.mca
```

```{r}
pred.pls.mca <- predict(pls.mca, valid.mca)
confusionMatrix(pred.pls.mca, valid.party)
```

### Kernal PLS

```{r}
set.seed(1056)
kpls.dv <- train(
    Party ~ .,
    data = train.dv[, -c(1, hc.dv)],
    # data = train.set[, -1],
    method = "kernelpls",
    trControl = trCtrl,
    metric = "ROC",
    tuneGrid = plsGrid,
    preProcess = c("center", "scale")
)
```

```{r}
kpls.dv
```

```{r}
pred.kpls.dv <- predict(kpls.dv, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.kpls.dv, valid.party)
```

## Penalized Models

```{r}
glmnGrid <- expand.grid(
    .alpha = c(0, 0.1, 0.2, 0.4, 0.6, 0.8, 1), 
    .lambda = seq(0.1, 0.2, length = 40)
)
```

### PCA

```{r}
if (!file.exists("models/glmnet_dv.Rds")) {
    set.seed(1056)
    glmnet.dv <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "glmnet",
        trControl = ctrl,
        metric = "ROC",
        tuneGrid = glmnGrid,
        preProcess = c("nzv", "pca")
    )
    
    saveRDS(glmnet.dv, "models/glmnet_dv.Rds")

} else {
    library(glmnet)
    glmnet.dv <- readRDS("models/glmnet_dv.Rds")
}
```

```{r}
glmnet.dv
```

```{r}
pred.glmnet.dv <- predict(glmnet.dv, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.glmnet.dv, valid.party)
```

```{r}
varImp(glmnet.dv)
```

### MCA

```{r}
if (!file.exists("models/glmnet_mca.Rds")) {
    set.seed(1056)
    glmnet.mca <- train(
        Party ~ .,
        # data = train.dv[, -1],
        data = train.mca[, -1],
        method = "glmnet",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = expand.grid(.alpha = 0.1, .lambda = 0.0044944)
    )
    
    saveRDS(glmnet.mca, "models/glmnet_mca.Rds")

} else {
    library(glmnet)
    glmnet.mca <- readRDS("models/glmnet_mca.Rds")
}
```

```{r}
glmnet.mca
```

```{r}
pred.glmnet.mca <- predict(glmnet.mca, valid.mca)
confusionMatrix(pred.glmnet.mca, valid.party)
```

```{r}
varImp(glmnet.mca)
```

## Nearest Shrunken Centroids

```{r}
nscGrid <- data.frame(.threshold = 0:25)
```

```{r}
if (!file.exists("models/nsc_dv.Rds")) {
    set.seed(1056)
    nsc.dv <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "pam",
        trControl = ctrl,
        metric = "ROC",
        tuneGrid = nscGrid,
        preProcess = "nzv"
    )
    
    saveRDS(nsc.dv, "models/nsc_dv.Rds")

} else {
    library(pamr)
    nsc.dv <- readRDS("models/nsc_dv.Rds")
}
```

```{r}
nsc.dv
```

```{r}
pred.nsc <- predict(nsc.dv, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.nsc, valid.party)
```

### MCA

```{r}
if (!file.exists("models/nsc_mca.Rds")) {
    set.seed(1056)
    nsc.mca <- train(
        Party ~ .,
        data = train.mca[, -1],
        method = "nsc",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = nscGrid
        # preProcess = c("center", "scale")
    )
    
    saveRDS(nsc.mca, "models/nsc_mca.Rds")

} else {
    library(nsc)
    nsc.mca <- readRDS("models/nsc_mca.Rds")
}
```

```{r}
nsc.mca
```

```{r}
pred.nsc.mca <- predict(nsc.mca, valid.mca)
confusionMatrix(pred.nsc.mca, valid.party)
```


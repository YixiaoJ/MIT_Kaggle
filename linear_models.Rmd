---
title: "Linear Classification Models"
output: html_notebook
---

```{r}
source("2-model_tests.R")
```

## Linear Discriminant Analysis

### PCA

```{r}
if (!file.exists("models/lda_pca.Rds")) {
    set.seed(1056)
    lda.pca <- train(
        Party ~ .,
        data = train.dv[, -1],
        method = "lda",
        trControl = trCtrl,
        metric = "ROC",
        preProcess = c("nzv", "pca")
    )
    
    saveRDS(lda.pca, "models/lda_pca.Rds")

} else {
    lda.pca <- readRDS("models/lda_pca.Rds")
}
```

```{r}
lda.pca
```

```{r}
pred.lda.pca <- predict(lda.pca, valid.dv[, -1])
confusionMatrix(pred.lda.pca, valid.party)
```

### ICA

```{r}
if (!file.exists("models/lda_ica.Rds")) {
    set.seed(1056)
    lda.ica <- train(
        Party ~ .,
        data = train.dv[, -1],
        method = "lda",
        trControl = trCtrl,
        metric = "ROC",
        preProcess = c("nzv", "ica")
    )
    
    saveRDS(lda.ica, "models/lda_ica.Rds")

} else {
    lda.ica <- readRDS("models/lda_ica.Rds")
}
```

```{r}
lda.ica
```

```{r}
pred.lda.ica <- predict(lda.ica, valid.dv[, -1])
confusionMatrix(pred.lda.ica, valid.party)
```

### MCA

```{r}
if (!file.exists("models/lda_mca.Rds")) {
    set.seed(1056)
    lda.mca <- train(
        Party ~ .,
        data = train.mca[, -1],
        method = "lda",
        trControl = trCtrl,
        metric = "ROC",
        preProcess = c("center", "scale")
    )
    
    saveRDS(lda.mca, "models/lda_mca.Rds")

} else {
    lda.mca <- readRDS("models/lda_mca.Rds")
}
```

```{r}
lda.mca
```

```{r}
pred.lda.mca <- predict(lda.mca, valid.mca)
confusionMatrix(pred.lda.mca, valid.party)
```

## Partial Least Squares

```{r}
plsGrid <- expand.grid(.ncomp = 1:10)
```

```{r}
if (!file.exists("models/pls_dv.Rds")) {
    set.seed(1056)
    pls.dv <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "pls",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = plsGrid,
        preProcess = c("center", "scale")
    )
    
    saveRDS(pls.dv, "models/pls_dv.Rds")

} else {
    library(pls)
    pls.dv <- readRDS("models/pls_dv.Rds")
}
```

```{r}
pls.dv
```

```{r}
pred.pls.dv <- predict(pls.dv, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.pls.dv, valid.party)
```

### PCA

```{r}
if (!file.exists("models/pls_dv_pca.Rds")) {
    set.seed(1056)
    pls.dv.pca <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "pls",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = plsGrid,
        preProcess = c("nzv", "pca")
    )
    
    saveRDS(pls.dv.pca, "models/pls_dv_pca.Rds")

} else {
    library(pls)
    pls.dv.pca <- readRDS("models/pls_dv_pca.Rds")
}
```

```{r}
pls.dv.pca
```

```{r}
pred.pls.dv.pca <- predict(pls.dv.pca, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.pls.dv.pca, valid.party)
```

### Kernal PLS

```{r}
if (!file.exists("models/kpls_dv.Rds")) {
    set.seed(1056)
    kpls.dv <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "kernelpls",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = plsGrid,
        preProcess = c("center", "scale")
    )
    saveRDS(kpls.dv, "models/kpls_dv.Rds")
    
} else {
    library(pls)
    kpls.dv <- readRDS("models/kpls_dv.Rds")
}
```

```{r}
kpls.dv
```

```{r}
pred.kpls.dv <- predict(kpls.dv, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.kpls.dv, valid.party)
```

## Penalized Models

```{r}
glmnGrid <- expand.grid(
    .alpha = c(0, 0.1, 0.2, 0.4, 0.6, 0.8, 1), 
    .lambda = seq(0.1, 0.2, length = 40)
)
```

```{r}
if (!file.exists("models/glmnet_dv.Rds")) {
    set.seed(1056)
    glmnet.dv <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "glmnet",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = glmnGrid,
        preProcess = c("nzv", "center", "scale")
    )
    
    saveRDS(glmnet.dv, "models/glmnet_dv.Rds")

} else {
    library(glmnet)
    glmnet.dv <- readRDS("models/glmnet_dv.Rds")
}
```

```{r}
glmnet.dv
```

```{r}
pred.glmnet.dv <- predict(glmnet.dv, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.glmnet.dv, valid.party)
```

### PCA

```{r}
if (!file.exists("models/glmnet_dv_pca.Rds")) {
    set.seed(1056)
    glmnet.dv.pca <- train(
        Party ~ .,
        data = train.dv[, -c(1, hc.dv)],
        method = "glmnet",
        trControl = ctrl,
        metric = "ROC",
        tuneGrid = glmnGrid,
        preProcess = c("nzv", "pca")
    )
    
    saveRDS(glmnet.dv.pca, "models/glmnet_dv_pca.Rds")

} else {
    library(glmnet)
    glmnet.dv.pca <- readRDS("models/glmnet_dv_pca.Rds")
}
```

```{r}
glmnet.dv.pca
```

```{r}
pred.glmnet.dv.pca <- predict(glmnet.dv.pca, valid.dv[, -c(1, hc.dv)])
confusionMatrix(pred.glmnet.dv.pca, valid.party)
```

```{r}
varImp(glmnet.dv.pca)
```

### MCA

```{r}
if (!file.exists("models/glmnet_mca.Rds")) {
    set.seed(1056)
    glmnet.mca <- train(
        Party ~ .,
        # data = train.dv[, -1],
        data = train.mca[, -1],
        method = "glmnet",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = expand.grid(.alpha = 0.1, .lambda = 0.0044944)
    )
    
    saveRDS(glmnet.mca, "models/glmnet_mca.Rds")

} else {
    library(glmnet)
    glmnet.mca <- readRDS("models/glmnet_mca.Rds")
}
```

```{r}
glmnet.mca
```

```{r}
pred.glmnet.mca <- predict(glmnet.mca, valid.mca)
confusionMatrix(pred.glmnet.mca, valid.party)
```

```{r}
varImp(glmnet.mca)
```

## Nearest Shrunken Centroids

```{r}
nscGrid <- data.frame(.threshold = 0:25)
```

```{r}
if (!file.exists("models/nsc_dv.Rds")) {
    set.seed(1056)
    nsc.dv <- train(
        Party ~ .,
        data = train.dv[, -1],
        method = "pam",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = nscGrid,
        preProcess = "nzv"
    )
    
    saveRDS(nsc.dv, "models/nsc_dv.Rds")

} else {
    library(pamr)
    nsc.dv <- readRDS("models/nsc_dv.Rds")
}
```

```{r}
nsc.dv
```

```{r}
pred.nsc <- predict(nsc.dv, valid.dv[, -1])
confusionMatrix(pred.nsc, valid.party)
```

### MCA

```{r}
if (!file.exists("models/nsc_mca.Rds")) {
    set.seed(1056)
    nsc.mca <- train(
        Party ~ .,
        data = train.mca[, -1],
        method = "pam",
        trControl = trCtrl,
        metric = "ROC",
        tuneGrid = nscGrid
        # preProcess = c("center", "scale")
    )
    
    saveRDS(nsc.mca, "models/nsc_mca.Rds")

} else {
    library(nsc)
    nsc.mca <- readRDS("models/nsc_mca.Rds")
}
```

```{r}
nsc.mca
```

```{r}
pred.nsc.mca <- predict(nsc.mca, valid.mca)
confusionMatrix(pred.nsc.mca, valid.party)
```

